function callWithDelay(t,e){let s;return function(...o){let n=this;clearTimeout(s),s=setTimeout(()=>t.apply(n,o),e)}}function startApp(){let t=window.location.host,e=window.location.pathname,s=new FitAddon.FitAddon,o=new Terminal({screenKeys:!0,cursorBlink:!0,macOptionIsMeta:!0,scrollback:!0,fontFamily:"Source Code Pro"}),n=window.location.protocol.indexOf("https")?"ws":"wss",a=new WebSocket(`${n}://${t}${e}pty`);function i(){s.fit(),console.log(o.cols,o.rows),a.send(JSON.stringify({action:"resize",data:{cols:o.cols,rows:o.rows}}))}o.loadAddon(s),window.onresize=callWithDelay(i,50),a.onopen=function(){o.open(document.getElementById("webpty")),o.options.scrollback=5e3,i()},a.onmessage=function(t){o.write(t.data)},o.onKey(t=>{a.send(JSON.stringify({action:"input",data:{key:t.key}}))}),o.attachCustomKeyEventHandler(t=>{(t.ctrlKey||t.metaKey)&&"KeyV"===t.code&&"keydown"===t.type&&(navigator.clipboard.readText().then(t=>{a.send(JSON.stringify({action:"input",data:{key:t}}))}),t.preventDefault())}),KEEP_ALIVE&&setInterval(function t(){a.send(JSON.stringify({action:"ping"}))},1e3*KEEP_ALIVE)}function getPasswordFromCookie(){let t=`; ${document.cookie}`,e=t.split("; webptyPass=");if(2===e.length)return e.pop().split(";").shift()}if(APP_SECURED){for(var userPassword=getPasswordFromCookie();null===userPassword||""===userPassword||void 0===userPassword;)if(userPassword=prompt("This is a password protected shell. Please enter your password.")){var t=new XMLHttpRequest;t.open("POST","/auth",!0),t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify({webptyPass:userPassword})),t.onreadystatechange=function(){4==this.readyState&&(200!==this.status&&(userPassword=null),200===this.status&&location.reload())}}}window.onload=startApp;
